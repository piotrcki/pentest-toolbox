#   Copyright (C) 2021 Piotr Chmielnicki
#
#   This program is free software; you can redistribute it and/or modify
#   it under the terms of the GNU General Public License as published by
#   the Free Software Foundation; either version 3 of the License, or
#   (at your option) any later version.
#
#   This program is distributed in the hope that it will be useful,
#   but WITHOUT ANY WARRANTY; without even the implied warranty of
#   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#   GNU General Public License for more details.
#
#   You should have received a copy of the GNU General Public License
#   along with this program; if not, write to the Free Software Foundation,
#   Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301  USA

FROM kalilinux/kali-rolling

ADD --chown=root:root sources.list /etc/apt/
RUN chmod 0644 /etc/apt/sources.list

RUN DEBIAN_FRONTEND=noninteractive apt-get update -y \
    && DEBIAN_FRONTEND=noninteractive apt-get install apt-utils -y \
    && DEBIAN_FRONTEND=noninteractive apt-get dist-upgrade -y \
    && echo "wireshark-common wireshark-common/install-setuid boolean false" \
    | debconf-set-selections \
    && DEBIAN_FRONTEND=noninteractive apt-get install \
    afl++ \
    aircrack-ng \
    arp-scan \
    awscli \
    bash-completion \
    bat \
    binwalk \
    bloodhound \
    build-essential \
    bwm-ng \
    dirb \
    dnsmap \
    dnsutils \
    dsniff \
    ettercap-text-only \
    geoip-bin \
    git \
    hashcat \
    hping3 \
    htop \
    httpie \
    hydra \
    iproute2 \
    iputils-ping \
    john \
    libldap2-dev \
    libsasl2-dev \
    libssl-dev \
    man-db \
    masscan \
    metasploit-framework \
    miscfiles \
    mitmproxy \
    mlocate \
    most \
    nikto \
    nmap \
    nuclei \
    openssl \
    pipx \
    proxychains4 \
    python2 \
    python3 \
    python3-dev \
    radare2 \
    scapy \
    screen \
    socat \
    sqlmap \
    sslscan \
    stunnel4 \
    subversion \
    tcptraceroute \
    termshark \
    testdisk \
    theharvester \
    traceroute \
    tshark \
    vim \
    whois \
    wpscan \
    xz-utils \
    -y \
    && DEBIAN_FRONTEND=noninteractive apt-get clean -y \
    && ln -s /usr/bin/batcat /usr/local/bin/bat \
    && rm -rf /var/log/*

RUN PIPX_HOME=/usr/local/lib/pipx PIPX_BIN_DIR=/usr/local/bin pipx install lsassy
RUN PIPX_HOME=/usr/local/lib/pipx PIPX_BIN_DIR=/usr/local/bin pipx install sprayhound

RUN cd /usr/share/ && git clone https://github.com/SpiderLabs/Responder/ 
RUN cd /usr/share/ && git clone https://github.com/Hackndo/pyGPOAbuse

RUN cd /tmp/ && git clone https://github.com/SecureAuthCorp/impacket && cd impacket \
    && PIPX_HOME=/usr/local/lib/pipx PIPX_BIN_DIR=/usr/local/bin pipx install . && cd .. && rm -r impacket

RUN cd /tmp/ && git clone https://github.com/robertdavidgraham/rdpscan \
    && cd rdpscan &&  make && cp -a rdpscan /usr/local/bin && cd .. && rm -r rdpscan

ADD --chown=root:root piotrcki-wordlist-top10m.txt.xz /usr/share/dict/
RUN unxz /usr/share/dict/piotrcki-wordlist-top10m.txt.xz \
    && chmod 0444 /usr/share/dict/piotrcki-wordlist-top10m.txt

RUN echo '# [piotrcki/pentest-toolbox] Setup defaults\nexport PAGER=most\nexport EDITOR=vim' >> /root/.bashrc
